set -e

if [ $# -eq 0 ]; then
    echo "No version number provided"
    exit 1
fi

python -m build
python -m twine upload \
    --repository testpypi \
    --username engenmt \
    --password R25hn9RY8ryDfGi \
    dist/permpy_engenmt-0.0.$1-py3-none-any.whl
python -m twine upload \
    --repository testpypi \
    --username engenmt \
    --password R25hn9RY8ryDfGi \
    dist/permpy-engenmt-0.0.$1.tar.gz
sleep 2
python -m pip install --index-url https://test.pypi.org/simple/ --no-deps permpy-engenmt==0.0.$1